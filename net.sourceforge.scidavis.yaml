app-id: net.sourceforge.scidavis
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: '5.15'
command: scidavis
#rename-icon: scidavis.png
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  #- --filesystem=home

modules:
  - shared-modules/glu/glu-9.json

  - name: muparser
    buildsystem: cmake
    cleanup:
      - /bin
    sources:
    - type: archive
      url: https://github.com/beltoforion/muparser/archive/v2.3.2.tar.gz
      sha256: b35fc84e3667d432e3414c8667d5764dfa450ed24a99eeef7ee3f6647d44f301   

    # Shamelessly taken from io.github.ciromattia.kcc  
  - name: pyqt5
    cleanup:
      - /bin
    buildsystem: simple
    build-commands:
      - PY_VER=python$(python3 -c 'import sys; print(sys.version[:3])') &&
        python3 configure.py
          --confirm-license
          --assume-shared
          --destdir=${FLATPAK_DEST}/lib/${PY_VER}/site-packages
          --stubsdir=${FLATPAK_DEST}/lib/${PY_VER}/site-packages/PyQt5
          --sipdir=${FLATPAK_DEST}/share/sip/PyQt5
          --no-designer-plugin
          --no-qml-plugin
          --no-python-dbus
          --no-tools
          --enable=QtCore
          --enable=QtGui
          --enable=QtNetwork
          --enable=QtWidgets
          ${config_opt}
      - make -j $FLATPAK_BUILDER_N_JOBS
      - make install
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/source/p/pyqt5/PyQt5-5.15.2.tar.gz
        sha256: 372b08dc9321d1201e4690182697c5e7ffb2e0770e6b4a45519025134b12e4fc
    modules:
      - pyqt5-pypi-dependencies.json  
        
  - name: gsl
    config-opts:
      - --disable-static
    cleanup:
     - /bin
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gsl/gsl-2.6.tar.gz
        sha256: b782339fc7a38fe17689cb39966c4d821236c28018b6593ddb6fd59ee40786a8
        
  - name: scidavis        
    buildsystem: cmake
    config-opts:
         - -DSCRIPTING_PYTHON:BOOL=ON
         - -DORIGIN_IMPORT:BOOL=ON
         - -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON
         - -DPyQt_INCLUDE_DIR=/app/share/sip/PyQt5
    post-install:
      - install -Dm644 scidavis/scidavis.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
    sources:
      - type: git
        url: https://github.com/highperformancecoder/scidavis
        commit: faf0b7a37aaddb3b14a063fb431067c7236d7032
